<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - GRUPO IT ARVIC</title>
    <link rel="stylesheet" href="../css/shared.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/arvic-pdf-styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
   
</head>
<body class="admin-layout">
    <header class="admin-header">
        <nav class="navbar">
            <div class="logo">
                <img src="../images/Logo Grupo IT Arvic 33.svg" alt="GRUPO IT ARVIC" class="admin-logo-svg">
            </div>
            <div class="user-info">
                <span id="adminUserName">Hector Perez</span>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
        </nav>
    </header>

    <main class="admin-content">
        <div class="container">
            <!-- Layout con Sidebar -->
            <div class="admin-layout-wrapper">
                <!-- Sidebar de Navegaci√≥n -->
                <div class="admin-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üìä Gesti√≥n General</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item active" data-section="usuarios">
                                <span class="menu-icon">üë•</span>
                                <span class="menu-text">Usuarios</span>
                                <span class="menu-badge" id="sidebarUsersCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="empresas">
                                <span class="menu-icon">üè¢</span>
                                <span class="menu-text">Empresas</span>
                                <span class="menu-badge" id="sidebarCompaniesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="proyectos">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Proyectos</span>
                                <span class="menu-badge" id="sidebarProjectsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="soportes">
                                <span class="menu-icon">üìû</span>
                                <span class="menu-text">Soportes</span>
                                <span class="menu-badge" id="sidebarSupportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="modulos">
                                <span class="menu-icon">üß©</span>
                                <span class="menu-text">M√≥dulos</span>
                                <span class="menu-badge" id="sidebarModulesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="tarifario">
                                <span class="menu-icon">üí∞</span>
                                <span class="menu-text">Tarifario</span>
                                <span class="menu-badge" id="sidebarTarifarioCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üéØ Asignaciones</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="crear-asignacion">
                                <span class="menu-icon">‚ûï</span>
                                <span class="menu-text">Asignar Soportes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="lista-asignaciones">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Lista Completa</span>
                                <span class="menu-badge" id="sidebarAssignmentsCount">0</span>
                            </div>
                            
                            <div class="sidebar-menu-item" data-section="asignaciones-recientes">
                                <span class="menu-icon">üïí</span>
                                <span class="menu-text">Recientes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="asignar-proyectos">
                                <span class="menu-icon">‚ûï</span>
                                <span class="menu-text">Asignar Proyectos</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="lista-proyectos-asignados">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Proyectos Asignados</span>
                                <span class="menu-badge" id="sidebarProjectAssignmentsCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üìÑ Reportes</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="reportes-pendientes">
                                <span class="menu-icon">üìä</span>
                                <span class="menu-text">Reportes Pendientes</span>
                                <span class="menu-badge" id="sidebarReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="reportes-aprobados">
                                <span class="menu-icon">‚úÖ</span>
                                <span class="menu-text">Reportes Aprobados</span>
                                <span class="menu-badge" id="sidebarApprovedReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="generar-reporte">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Generar Reporte</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="historial-reportes">
                                <span class="menu-icon">üìú</span>
                                <span class="menu-text">Historial Generados</span>
                                <span class="menu-badge" id="sidebarGeneratedReportsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido Principal -->
                <div class="admin-main-content">
                    <!-- Secci√≥n de Usuarios -->
                    <div id="usuarios-section" class="content-section active">
                        <div class="section-header">
                            <h2 class="section-title">üë• Gesti√≥n de Usuarios</h2>
                            <button class="add-btn" onclick="openUserModal()">+ Nuevo Usuario</button>
                        </div>
                        <div class="items-list" id="usersList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üë§</div>
                                <div class="empty-state-title">No hay usuarios</div>
                                <div class="empty-state-desc">Cree el primer usuario consultor</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Empresas -->
                    <div id="empresas-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üè¢ Gesti√≥n de Empresas</h2>
                            <button class="add-btn" onclick="openCompanyModal()">+ Nueva Empresa</button>
                        </div>
                        <div class="items-list" id="companiesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üè¢</div>
                                <div class="empty-state-title">No hay empresas</div>
                                <div class="empty-state-desc">Registre la primera empresa cliente</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Proyectos -->
                    <div id="proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Gesti√≥n de Proyectos</h2>
                            <button class="add-btn" onclick="openProjectModal()">+ Nuevo Proyecto</button>
                        </div>
                        <div class="items-list" id="projectsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <div class="empty-state-title">No hay proyectos</div>
                                <div class="empty-state-desc">Cree el primer proyecto</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Tareas -->
                    <div id="soportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìû Gesti√≥n de Soportes</h2>
                            <button class="add-btn" onclick="openSupportModal()">+ Nuevo Soporte</button>
                        </div>
                        <div class="items-list" id="supportsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìû</div>
                                <div class="empty-state-title">No hay soportes</div>
                                <div class="empty-state-desc">Cree el primer soporte</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de M√≥dulos -->
                    <div id="modulos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üß© Gesti√≥n de M√≥dulos</h2>
                            <button class="add-btn" onclick="openModuleModal()">+ Nuevo M√≥dulo</button>
                        </div>
                        <div class="items-list" id="modulesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üß©</div>
                                <div class="empty-state-title">No hay m√≥dulos</div>
                                <div class="empty-state-desc">Cree el primer m√≥dulo</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Nueva Asignaci√≥n -->
                    <div id="crear-asignacion-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">‚ûï Crear Nueva Asignaci√≥n de Soporte</h2>
                        </div>
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <div class="form-group">
                                    <label for="assignUser">Usuario Consultor</label>
                                    <select id="assignUser" name="assignUser" required>
                                        <option value="">Seleccionar usuario</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignCompany">Empresa Cliente</label>
                                    <select id="assignCompany" name="assignCompany" required>
                                        <option value="">Seleccionar empresa</option>
                                    </select>
                                </div>
                                <!-- ‚úÖ ELEMENTO CR√çTICO - ASEGURAR QUE EST√â EXACTAMENTE AS√ç -->
                                <div class="form-group">
                                    <label for="assignSupport">Soporte</label>
                                    <select id="assignSupport" name="assignSupport" required>
                                        <option value="">Seleccionar Soporte</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignModule">M√≥dulos</label>
                                    <select id="assignModule" name="assignModule" required>
                                        <option value="">Seleccionar M√≥dulo</option>
                                    </select>
                                </div>
                                <!-- Secci√≥n de Tarifas -->
                                <div class="tarifa-section">
                                    <h4 class="tarifa-title">üí∞ Configuraci√≥n de Tarifas</h4>
                                    
                                    <div class="tarifa-inputs">
                                        <div class="form-group">
                                            <label for="assignTarifaConsultor">Tarifa Consultor ($/hora)</label>
                                            <input 
                                                type="number" 
                                                id="assignTarifaConsultor" 
                                                name="assignTarifaConsultor" 
                                                step="0.01" 
                                                min="0" 
                                                placeholder="300.00"
                                                required
                                            >
                                            <small class="form-hint">Costo por hora que se le paga al consultor</small>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="assignTarifaCliente">Tarifa Cliente ($/hora)</label>
                                            <input 
                                                type="number" 
                                                id="assignTarifaCliente" 
                                                name="assignTarifaCliente" 
                                                step="0.01" 
                                                min="0" 
                                                placeholder="500.00"
                                                required
                                            >
                                            <small class="form-hint">Costo por hora que se le cobra al cliente</small>
                                        </div>
                                    </div>
                                    
                                    <div class="margen-display">
                                        <div class="margen-info">
                                            <span class="margen-label">Margen:</span>
                                            <span id="assignMargen" class="margen-value">$0.00</span>
                                            <span id="assignMargenPorcentaje" class="margen-percent">(0%)</span>
                                        </div>
                                        <div id="assignMargenWarning" class="margen-warning" style="display: none;">
                                            ‚ö†Ô∏è El margen es negativo
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createAssignment()">
                                    ‚ûï Crear Asignaci√≥n
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Asignar Proyectos -->
                    <div id="asignar-proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üéØ Asignar Proyecto a Consultor</h2>
                        </div>
                        
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <!-- Consultor -->
                                <div class="form-group">
                                    <label for="assignProjectConsultor">Consultor</label>
                                    <select id="assignProjectConsultor" name="assignProjectConsultor" required>
                                        <option value="">Seleccionar consultor</option>
                                    </select>
                                </div>
                                
                                <!-- Proyecto -->
                                <div class="form-group">
                                    <label for="assignProjectProject">Proyecto</label>
                                    <select id="assignProjectProject" name="assignProjectProject" required>
                                        <option value="">Seleccionar proyecto</option>
                                    </select>
                                </div>
                                
                                <!-- Empresa Cliente -->
                                <div class="form-group">
                                    <label for="assignProjectCompany">Empresa Cliente</label>
                                    <select id="assignProjectCompany" name="assignProjectCompany" required>
                                        <option value="">Seleccionar empresa cliente</option>
                                    </select>
                                </div>
                                
                                <!-- M√≥dulo -->
                                <div class="form-group">
                                    <label for="assignProjectModule">M√≥dulo</label>
                                    <select id="assignProjectModule" name="assignProjectModule" required>
                                        <option value="">Seleccionar m√≥dulo</option>
                                    </select>
                                </div>
                                <!-- Secci√≥n de Tarifas -->
                                <div class="tarifa-section">
                                    <h4 class="tarifa-title">üí∞ Configuraci√≥n de Tarifas</h4>
                                    
                                    <div class="tarifa-inputs">
                                        <div class="form-group">
                                            <label for="projectAssignTarifaConsultor">Tarifa Consultor ($/hora)</label>
                                            <input 
                                                type="number" 
                                                id="projectAssignTarifaConsultor" 
                                                name="projectAssignTarifaConsultor" 
                                                step="0.01" 
                                                min="0" 
                                                placeholder="300.00"
                                                required
                                            >
                                            <small class="form-hint">Costo por hora que se le paga al consultor</small>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="projectAssignTarifaCliente">Tarifa Cliente ($/hora)</label>
                                            <input 
                                                type="number" 
                                                id="projectAssignTarifaCliente" 
                                                name="projectAssignTarifaCliente" 
                                                step="0.01" 
                                                min="0" 
                                                placeholder="500.00"
                                                required
                                            >
                                            <small class="form-hint">Costo por hora que se le cobra al cliente</small>
                                        </div>
                                    </div>
                                    
                                    <div class="margen-display">
                                        <div class="margen-info">
                                            <span class="margen-label">Margen:</span>
                                            <span id="projectAssignMargen" class="margen-value">$0.00</span>
                                            <span id="projectAssignMargenPorcentaje" class="margen-percent">(0%)</span>
                                        </div>
                                        <div id="projectAssignMargenWarning" class="margen-warning" style="display: none;">
                                            ‚ö†Ô∏è El margen es negativo
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createProjectAssignment()">
                                    üéØ Asignar Proyecto
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Lista de Proyectos Asignados -->
                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="project-assignments-container">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecer√°n aqu√≠</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Lista de Asignaciones -->
                    <div id="lista-asignaciones-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Lista Completa de Asignaciones</h2>
                        </div>
                        <div class="assignments-list" id="assignmentsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üîó</div>
                                <div class="empty-state-title">No hay asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones creadas aparecer√°n en esta lista</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Asignaciones Recientes -->
                    <div id="asignaciones-recientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üïí Asignaciones Recientes</h2>
                        </div>
                        <div class="items-list" id="recentAssignments">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">Sin asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones recientes aparecer√°n aqu√≠</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Pendientes -->
                    <div id="reportes-pendientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìä Reportes Pendientes</h2>
                        </div>
                        
                        <!-- ‚ú® NUEVO: Filtros por Categor√≠a -->
                        <div class="reports-category-filters">
                            <div class="filter-buttons-group">
                                <button class="category-filter-btn active" data-category="all" onclick="filterReportsByCategory('all')">
                                    <span class="filter-icon">üìä</span>
                                    <span class="filter-text">Todos</span>
                                    <span class="filter-count" id="filterCountAll">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="soporte" onclick="filterReportsByCategory('soporte')">
                                    <span class="filter-icon">üìû</span>
                                    <span class="filter-text">Soporte</span>
                                    <span class="filter-count" id="filterCountSoporte">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="proyecto" onclick="filterReportsByCategory('proyecto')">
                                    <span class="filter-icon">üìã</span>
                                    <span class="filter-text">Proyecto</span>
                                    <span class="filter-count" id="filterCountProyecto">0</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="reportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <!-- Columna "Tipo Soporte" eliminada -->
                                        <th>M√≥dulo</th>
                                        <th>Horas Reportadas</th>
                                        <th>Fecha Reporte</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìÑ</div>
                                                <div class="empty-state-title">No hay reportes</div>
                                                <div class="empty-state-desc">Los reportes enviados por consultores aparecer√°n aqu√≠</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Aprobados -->
                    <div id="reportes-aprobados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">‚úÖ Reportes Aprobados - Horas Acumuladas</h2>
                        </div>
                        
                        <div class="reports-category-filters">
                            <div class="filter-buttons-group">
                                <button class="category-filter-btn active" data-category="all" onclick="filterApprovedReportsByCategory('all')">
                                    <span class="filter-icon">üìä</span>
                                    <span class="filter-text">Todos</span>
                                    <span class="filter-count" id="approvedFilterCountAll">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="soporte" onclick="filterApprovedReportsByCategory('soporte')">
                                    <span class="filter-icon">üìû</span>
                                    <span class="filter-text">Soporte</span>
                                    <span class="filter-count" id="approvedFilterCountSoporte">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="proyecto" onclick="filterApprovedReportsByCategory('proyecto')">
                                    <span class="filter-icon">üìã</span>
                                    <span class="filter-text">Proyecto</span>
                                    <span class="filter-count" id="approvedFilterCountProyecto">0</span>
                                </button>
                            </div>
                        </div>

                        <!-- Filtros de Fecha -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="timeFilter">Filtrar por:</label>
                                <select id="timeFilter" onchange="updateApprovedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todas las Fechas</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="customDateRange" style="display: none;">
                                <label for="startDate">Fecha Inicio:</label>
                                <input type="date" id="startDate" onchange="updateApprovedReportsList()">
                                
                                <label for="endDate">Fecha Fin:</label>
                                <input type="date" id="endDate" onchange="updateApprovedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="filterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="approvedReportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>ID Cliente</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>M√≥dulo</th>
                                        <th>Horas Acumuladas</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedReportsTableBody">
                                    <tr>
                                        <td colspan="7" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">‚úÖ</div>
                                                <div class="empty-state-title">No hay reportes aprobados</div>
                                                <div class="empty-state-desc">Los reportes aprobados aparecer√°n aqu√≠ con horas acumuladas</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                            <!-- Secci√≥n de Generar Reporte -->
                            <div id="generar-reporte-section" class="content-section">
                                <div class="section-header">
                                    <h2 class="section-title">üìã Sistema de Reportes ARVIC</h2>
                                    <p class="section-subtitle">Genere reportes detallados seg√∫n documentaci√≥n oficial</p>
                                </div>
                                
                                <!-- Selector de Reportes -->
                                <div class="report-selector">
                                    <h3>üéØ Seleccionar Tipo de Reporte</h3>
                                    <div class="report-grid" id="reportGrid">
                                        <!-- Se generar√° din√°micamente con JavaScript -->
                                    </div>
                                </div>

                                <!-- Panel de Configuraci√≥n Din√°mico -->
                                <div class="report-config-panel" id="reportConfigPanel" style="display: none;">
                                    <!-- Se generar√° din√°micamente seg√∫n el reporte seleccionado -->
                                </div>

                                <!-- Vista Previa Editable -->
                                <div class="preview-panel" id="reportPreviewPanel" style="display: none;">
                                    <!-- Se generar√° din√°micamente seg√∫n los datos -->
                                </div>

                                <!-- Opciones Generales (MANTENER) -->
                                <div class="report-options">
                                    <h3>Opciones Generales</h3>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-secondary" onclick="exportData()">
                                            üíæ Exportar Datos Completos
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="importData()">
                                            üìÅ Importar Datos
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="generateAdminReport()">
                                            üìã Reporte Administrativo
                                        </button>
                                    </div>
                                </div>
                            </div>

                    <!-- Secci√≥n de Historial de Reportes Generados -->
                    <div id="historial-reportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìú Historial de Reportes Generados</h2>
                            <button class="add-btn" onclick="refreshGeneratedReportsList()">üîÑ Actualizar</button>
                        </div>
                        
                        <!-- Filtros para Historial -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="historialTimeFilter">Per√≠odo:</label>
                                <select id="historialTimeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todos los Reportes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="historialTypeFilter">Tipo:</label>
                                <select id="historialTypeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="all">Todos los Tipos</option>
                                    <option value="actividades">Reportes de Actividades</option>
                                    <option value="pagos">Reportes de Pagos</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="historialCustomDateRange" style="display: none;">
                                <label for="historialStartDate">Fecha Inicio:</label>
                                <input type="date" id="historialStartDate" onchange="updateGeneratedReportsList()">
                                
                                <label for="historialEndDate">Fecha Fin:</label>
                                <input type="date" id="historialEndDate" onchange="updateGeneratedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="historialFilterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                    
                        <!-- Tabla de Reportes Generados -->
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="generatedReportsTable">
                                <thead>
                                    <tr>
                                        <th>Nombre del Archivo</th>
                                        <th>Tipo de Reporte</th>
                                        <th>Per√≠odo</th>
                                        <th>Registros</th>
                                        <th>Horas Totales</th>
                                        <th>Monto Total</th>
                                        <th>Fecha Generaci√≥n</th>
                                        <th>Descargas</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="generatedReportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìä</div>
                                                <div class="empty-state-title">No hay reportes generados</div>
                                                <div class="empty-state-desc">Los reportes Excel generados aparecer√°n en este historial</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Estad√≠sticas del Historial -->
                        <div class="historial-stats">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalGeneratedReports">0</div>
                                    <div class="stat-label">Total Reportes</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalActividadReports">0</div>
                                    <div class="stat-label">Rep. Actividades</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalPagoReports">0</div>
                                    <div class="stat-label">Rep. Pagos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalDownloads">0</div>
                                    <div class="stat-label">Total Descargas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                            <!-- Secci√≥n de Tarifario -->
                    <div id="tarifario-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üí∞ Tarifario - Gesti√≥n de Costos</h2>
                            <button class="btn btn-export" onclick="exportTarifarioToExcel()">
                                üì§ Exportar a Excel
                            </button>
                        </div>

                        <!-- Filtros de tipo -->
                        <div class="tarifario-filters">
                            <button class="filter-btn active" data-type="all" onclick="filterTarifarioByType('all')">
                                üìä Todos
                            </button>
                            <button class="filter-btn" data-type="soporte" onclick="filterTarifarioByType('soporte')">
                                üìû Soportes
                            </button>
                            <button class="filter-btn" data-type="proyecto" onclick="filterTarifarioByType('proyecto')">
                                üìã Proyectos
                            </button>
                        </div>

                        <!-- Estad√≠sticas r√°pidas -->
                        <div class="tarifario-stats">
                            <div class="stat-card">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-content">
                                    <span class="stat-label">Total Asignaciones</span>
                                    <span class="stat-value" id="totalAsignaciones">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üí∞</div>
                                <div class="stat-content">
                                    <span class="stat-label">Margen Promedio</span>
                                    <span class="stat-value" id="margenPromedio">$0.00</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìà</div>
                                <div class="stat-content">
                                    <span class="stat-label">Total Consultores</span>
                                    <span class="stat-value" id="totalConsultores">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de Uni√≥n -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">üìä Tabla de Uni√≥n - Asignaciones con Tarifas</h3>
                                <div class="table-info">
                                    <span id="tarifarioCount">0 asignaciones</span>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="tarifario-table">
                                    <thead>
                                        <tr>
                                            <th>Tipo</th>
                                            <th>ID Asignaci√≥n</th>
                                            <th>M√≥dulo</th>
                                            <th>Consultor</th>
                                            <th>Cliente</th>
                                            <th>Trabajo</th>
                                            <th>Costo Consultor</th>
                                            <th>Costo Cliente</th>
                                            <th>Margen</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tarifarioTableBody">
                                        <tr>
                                            <td colspan="10" class="empty-state-cell">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon">üí∞</div>
                                                    <div class="empty-state-title">No hay tarifas configuradas</div>
                                                    <div class="empty-state-desc">Las tarifas se crean autom√°ticamente al crear asignaciones</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tabla de Consultores -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">üë• Resumen por Consultor</h3>
                                <div class="table-info">
                                    <span id="consultoresCount">0 consultores</span>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="consultores-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Total Asignaciones</th>
                                            <th>M√≥dulos</th>
                                            <th>Clientes</th>
                                            <th>Promedio Tarifa</th>
                                        </tr>
                                    </thead>
                                    <tbody id="consultoresTableBody">
                                        <tr>
                                            <td colspan="6" class="empty-state-cell">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon">üë•</div>
                                                    <div class="empty-state-title">No hay consultores con asignaciones</div>
                                                    <div class="empty-state-desc">Asigne proyectos o soportes a consultores para ver el resumen</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Usuario -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë§ Crear Nuevo Usuario</h2>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm" class="admin-form">
                    <div class="form-group">
                        <label for="userName">Nombre Completo *</label>
                        <input type="text" id="userName" placeholder="Ej: Juan P√©rez Garc√≠a" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email (opcional)</label>
                        <input type="email" id="userEmail" placeholder="juan.perez@empresa.com">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Usuario</button>
                    </div>
                </form>
                <div class="message message-info">
                    <strong>Informaci√≥n:</strong> El sistema generar√° autom√°ticamente un ID √∫nico y una contrase√±a temporal para el nuevo usuario.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üè¢ Registrar Nueva Empresa</h2>
                <button class="close" onclick="closeModal('companyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="companyForm" class="admin-form">
                    <div class="form-group">
                        <label for="companyName">Nombre de la Empresa *</label>
                        <input type="text" id="companyName" placeholder="Ej: Tecnolog√≠a Avanzada SA de CV" required>
                    </div>
                    <div class="form-group">
                        <label for="companyDescription">Descripci√≥n (opcional)</label>
                        <textarea id="companyDescription" placeholder="Breve descripci√≥n de la empresa y sus servicios" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Registrar Empresa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Proyecto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìã Crear Nuevo Proyecto</h2>
                <button class="close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm" class="admin-form">
                    <div class="form-group">
                        <label for="projectName">Nombre del Proyecto *</label>
                        <input type="text" id="projectName" placeholder="Ej: Sistema de Gesti√≥n Empresarial" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Descripci√≥n (opcional)</label>
                        <textarea id="projectDescription" placeholder="Descripci√≥n detallada del proyecto" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Proyecto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Soporte -->
    <div id="supportModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">üìû Crear Nuevo Soporte</h2>
            <button class="close" onclick="closeModal('supportModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="supportForm" class="admin-form">
                <div class="form-group">
                    <label for="supportName">Nombre del Soporte *</label>
                    <input type="text" id="supportName" placeholder="Ej: Soporte t√©cnico sistema ERP" required>
                </div>
                <div class="form-group">
                    <label for="supportDescription">Descripci√≥n (opcional)</label>
                    <textarea id="supportDescription" placeholder="Descripci√≥n detallada del soporte" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Crear Soporte</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal M√≥dulo -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üß© Crear Nuevo M√≥dulo</h2>
                <button class="close" onclick="closeModal('moduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="moduleForm" class="admin-form">
                    <div class="form-group">
                        <label for="moduleName">Nombre del M√≥dulo *</label>
                        <input type="text" id="moduleName" placeholder="Ej: M√≥dulo MM" required>
                    </div>
                    <div class="form-group">
                        <label for="moduleDescription">Descripci√≥n (opcional)</label>
                        <textarea id="moduleDescription" placeholder="Descripci√≥n detallada del m√≥dulo" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear M√≥dulo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/database.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/utils.js"></script>
    <script src="admin.js"></script>
    <script src="../js/module-acronym-utils.js"></script>
    <script src="../js/arvic-pdf-exporter.js"></script>
</body>
</html>