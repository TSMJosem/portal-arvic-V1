<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - GRUPO IT ARVIC</title>
    <link rel="stylesheet" href="../css/shared.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="admin-layout">
    <header class="admin-header">
        <nav class="navbar">
            <div class="logo">
                <img src="../images/Logo Grupo IT Arvic 33.svg" alt="GRUPO IT ARVIC" class="admin-logo-svg">
            </div>
            <div class="user-info">
                <span id="adminUserName">Hector Perez</span>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
        </nav>
    </header>

    <main class="admin-content">
        <div class="container">
            <!-- Layout con Sidebar -->
            <div class="admin-layout-wrapper">
                <!-- Sidebar de Navegaci√≥n -->
                <div class="admin-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üìä Gesti√≥n General</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item active" data-section="usuarios">
                                <span class="menu-icon">üë•</span>
                                <span class="menu-text">Usuarios</span>
                                <span class="menu-badge" id="sidebarUsersCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="empresas">
                                <span class="menu-icon">üè¢</span>
                                <span class="menu-text">Empresas</span>
                                <span class="menu-badge" id="sidebarCompaniesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="proyectos">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Proyectos</span>
                                <span class="menu-badge" id="sidebarProjectsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="soportes">
                                <span class="menu-icon">üìû</span>
                                <span class="menu-text">Soportes</span>
                                <span class="menu-badge" id="sidebarSupportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="modulos">
                                <span class="menu-icon">üß©</span>
                                <span class="menu-text">M√≥dulos</span>
                                <span class="menu-badge" id="sidebarModulesCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üéØ Asignaciones</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="crear-asignacion">
                                <span class="menu-icon">‚ûï</span>
                                <span class="menu-text">Asignar Soportes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="lista-asignaciones">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Lista Completa</span>
                                <span class="menu-badge" id="sidebarAssignmentsCount">0</span>
                            </div>
                            
                            <div class="sidebar-menu-item" data-section="asignaciones-recientes">
                                <span class="menu-icon">üïí</span>
                                <span class="menu-text">Recientes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="asignar-proyectos">
                                <span class="menu-icon">üéØ</span>
                                <span class="menu-text">Asignar Proyectos</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="lista-proyectos-asignados">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Proyectos Asignados</span>
                                <span class="menu-badge" id="sidebarProjectAssignmentsCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title">üìÑ Reportes</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="reportes-pendientes">
                                <span class="menu-icon">üìä</span>
                                <span class="menu-text">Reportes Pendientes</span>
                                <span class="menu-badge" id="sidebarReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="reportes-aprobados">
                                <span class="menu-icon">‚úÖ</span>
                                <span class="menu-text">Reportes Aprobados</span>
                                <span class="menu-badge" id="sidebarApprovedReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="generar-reporte">
                                <span class="menu-icon">üìã</span>
                                <span class="menu-text">Generar Reporte</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="historial-reportes">
                                <span class="menu-icon">üìú</span>
                                <span class="menu-text">Historial Generados</span>
                                <span class="menu-badge" id="sidebarGeneratedReportsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido Principal -->
                <div class="admin-main-content">
                    <!-- Secci√≥n de Usuarios -->
                    <div id="usuarios-section" class="content-section active">
                        <div class="section-header">
                            <h2 class="section-title">üë• Gesti√≥n de Usuarios</h2>
                            <button class="add-btn" onclick="openUserModal()">+ Nuevo Usuario</button>
                        </div>
                        <div class="items-list" id="usersList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üë§</div>
                                <div class="empty-state-title">No hay usuarios</div>
                                <div class="empty-state-desc">Cree el primer usuario consultor</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Empresas -->
                    <div id="empresas-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üè¢ Gesti√≥n de Empresas</h2>
                            <button class="add-btn" onclick="openCompanyModal()">+ Nueva Empresa</button>
                        </div>
                        <div class="items-list" id="companiesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üè¢</div>
                                <div class="empty-state-title">No hay empresas</div>
                                <div class="empty-state-desc">Registre la primera empresa cliente</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Proyectos -->
                    <div id="proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Gesti√≥n de Proyectos</h2>
                            <button class="add-btn" onclick="openProjectModal()">+ Nuevo Proyecto</button>
                        </div>
                        <div class="items-list" id="projectsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <div class="empty-state-title">No hay proyectos</div>
                                <div class="empty-state-desc">Cree el primer proyecto</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Tareas -->
                    <div id="soportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìû Gesti√≥n de Soportes</h2>
                            <button class="add-btn" onclick="openSupportModal()">+ Nuevo Soporte</button>
                        </div>
                        <div class="items-list" id="supportsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìû</div>
                                <div class="empty-state-title">No hay soportes</div>
                                <div class="empty-state-desc">Cree el primer soporte</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de M√≥dulos -->
                    <div id="modulos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üß© Gesti√≥n de M√≥dulos</h2>
                            <button class="add-btn" onclick="openModuleModal()">+ Nuevo M√≥dulo</button>
                        </div>
                        <div class="items-list" id="modulesList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üß©</div>
                                <div class="empty-state-title">No hay m√≥dulos</div>
                                <div class="empty-state-desc">Cree el primer m√≥dulo</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Nueva Asignaci√≥n -->
                    <div id="crear-asignacion-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">‚ûï Crear Nueva Asignaci√≥n de Soporte</h2>
                        </div>
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <div class="form-group">
                                    <label for="assignUser">Usuario Consultor</label>
                                    <select id="assignUser" name="assignUser" required>
                                        <option value="">Seleccionar usuario</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignCompany">Empresa Cliente</label>
                                    <select id="assignCompany" name="assignCompany" required>
                                        <option value="">Seleccionar empresa</option>
                                    </select>
                                </div>
                                <!-- ‚úÖ ELEMENTO CR√çTICO - ASEGURAR QUE EST√â EXACTAMENTE AS√ç -->
                                <div class="form-group">
                                    <label for="assignSupport">Soporte</label>
                                    <select id="assignSupport" name="assignSupport" required>
                                        <option value="">Seleccionar Soporte</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="assignModule">M√≥dulos</label>
                                    <select id="assignModule" name="assignModule" required>
                                        <option value="">Seleccionar M√≥dulo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createAssignment()">
                                    ‚ûï Crear Asignaci√≥n
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Asignar Proyectos -->
                    <div id="asignar-proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üéØ Asignar Proyecto a Consultor</h2>
                        </div>
                        
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <!-- Consultor -->
                                <div class="form-group">
                                    <label for="assignProjectConsultor">Consultor</label>
                                    <select id="assignProjectConsultor" name="assignProjectConsultor" required>
                                        <option value="">Seleccionar consultor</option>
                                    </select>
                                </div>
                                
                                <!-- Proyecto -->
                                <div class="form-group">
                                    <label for="assignProjectProject">Proyecto</label>
                                    <select id="assignProjectProject" name="assignProjectProject" required>
                                        <option value="">Seleccionar proyecto</option>
                                    </select>
                                </div>
                                
                                <!-- Empresa Cliente -->
                                <div class="form-group">
                                    <label for="assignProjectCompany">Empresa Cliente</label>
                                    <select id="assignProjectCompany" name="assignProjectCompany" required>
                                        <option value="">Seleccionar empresa cliente</option>
                                    </select>
                                </div>
                                
                                <!-- M√≥dulo -->
                                <div class="form-group">
                                    <label for="assignProjectModule">M√≥dulo</label>
                                    <select id="assignProjectModule" name="assignProjectModule" required>
                                        <option value="">Seleccionar m√≥dulo</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group" style="text-align: center; margin-top: 20px;">
                                <button type="button" class="btn btn-primary" onclick="createProjectAssignment()">
                                    üéØ Asignar Proyecto
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="assignments-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecer√°n aqu√≠</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Lista de Proyectos Asignados -->
                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="project-assignments-container">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecer√°n aqu√≠</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Lista de Asignaciones -->
                    <div id="lista-asignaciones-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Lista Completa de Asignaciones</h2>
                        </div>
                        <div class="assignments-list" id="assignmentsList">
                            <div class="empty-state">
                                <div class="empty-state-icon">üîó</div>
                                <div class="empty-state-title">No hay asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones creadas aparecer√°n en esta lista</div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Asignaciones Recientes -->
                    <div id="asignaciones-recientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üïí Asignaciones Recientes</h2>
                        </div>
                        <div class="items-list" id="recentAssignments">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <div class="empty-state-title">Sin asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones recientes aparecer√°n aqu√≠</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Pendientes -->
                    <div id="reportes-pendientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìä Reportes Pendientes</h2>
                        </div>
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="reportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>Tipo Soporte</th>
                                        <th>M√≥dulo</th>
                                        <th>Horas Reportadas</th>
                                        <th>Fecha Reporte</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody">
                                    <tr>
                                        <td colspan="10" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìÑ</div>
                                                <div class="empty-state-title">No hay reportes</div>
                                                <div class="empty-state-desc">Los reportes enviados por consultores aparecer√°n aqu√≠</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Aprobados -->
                    <div id="reportes-aprobados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">‚úÖ Reportes Aprobados - Horas Acumuladas</h2>
                        </div>
                        
                        <!-- Filtros de Fecha -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="timeFilter">Filtrar por:</label>
                                <select id="timeFilter" onchange="updateApprovedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todas las Fechas</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="customDateRange" style="display: none;">
                                <label for="startDate">Fecha Inicio:</label>
                                <input type="date" id="startDate" onchange="updateApprovedReportsList()">
                                
                                <label for="endDate">Fecha Fin:</label>
                                <input type="date" id="endDate" onchange="updateApprovedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="filterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="approvedReportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>ID Cliente</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>Tipo Soporte</th>
                                        <th>M√≥dulo</th>
                                        <th>Horas Acumuladas</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedReportsTableBody">
                                    <tr>
                                        <td colspan="8" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">‚úÖ</div>
                                                <div class="empty-state-title">No hay reportes aprobados</div>
                                                <div class="empty-state-desc">Los reportes aprobados aparecer√°n aqu√≠ con horas acumuladas</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Secci√≥n de Generar Reporte -->
                    <div id="generar-reporte-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìã Generar Reportes</h2>
                        </div>
                        
                        <div class="report-generator">
                            <!-- Selector de Tipo de Reporte -->
                            <div class="report-type-selector">
                                <h3>Seleccionar Tipo de Reporte</h3>
                                <div class="report-type-options">
                                    <div class="report-type-card" onclick="selectReportType('actividades')">
                                        <div class="report-type-icon">üìä</div>
                                        <h4>Reporte de Actividades</h4>
                                        <p>Reporte de horas trabajadas por consultor y asignaci√≥n</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pagos')">
                                        <div class="report-type-icon">üí∞</div>
                                        <h4>Reporte de Pago Consultores</h4>
                                        <p>Reporte de pagos con tarifas editables por consultor</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pago_consultor_general')">
                                        <div class="report-type-icon">üè¢</div>
                                            <h4>Pago Consultor (General)</h4>
                                            <p>Resumen de pagos consolidado para todos los consultores</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('pago_consultor_individual')">
                                        <div class="report-type-icon">üë§</div>
                                        <h4>Pago Consultor (Consultor)</h4>
                                        <p>Reporte de pagos individual para un consultor espec√≠fico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('cliente_soporte')">
                                        <div class="report-type-icon">üìû</div>
                                        <h4>Cliente Soporte</h4>
                                        <p>Reporte de servicios de soporte para un cliente espec√≠fico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto')">
                                        <div class="report-type-icon">üìã</div>
                                        <h4>Reporte Proyecto</h4>
                                        <p>Detalle de todos los consultores en un proyecto espec√≠fico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto_cliente')">
                                        <div class="report-type-icon">üè¢</div>
                                        <h4>Rep. Proyecto (Cliente)</h4>
                                        <p>Vista de proyectos orientada al cliente, agrupada por m√≥dulos</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_proyecto_consultor')">
                                        <div class="report-type-icon">üë§</div>
                                        <h4>Rep. Proyecto (Consultor)</h4>
                                        <p>Reporte personal del consultor en proyecto espec√≠fico</p>
                                    </div>
                                    <div class="report-type-card" onclick="selectReportType('reporte_remanente')">
                                        <div class="report-type-icon">üìä</div>
                                        <h4>Reporte Remanente</h4>
                                        <p>Control matricial semanal de horas remanentes por m√≥dulo</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte de Actividades -->
                            <div id="actividades-config" class="report-config" style="display: none;">
                                <h3>üìä Configuraci√≥n - Reporte de Actividades</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label for="actividadesTimeFilter">Per√≠odo:</label>
                                        <select id="actividadesTimeFilter">
                                            <option value="week">Esta Semana</option>
                                            <option value="month">Este Mes</option>
                                            <option value="custom">Rango Personalizado</option>
                                            <option value="all">Todas las Fechas</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group" id="actividadesCustomDateRange" style="display: none;">
                                        <label for="actividadesStartDate">Fecha Inicio:</label>
                                        <input type="date" id="actividadesStartDate">
                                        
                                        <label for="actividadesEndDate">Fecha Fin:</label>
                                        <input type="date" id="actividadesEndDate">
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" onclick="generateActividadesReport()">
                                            üìä Generar Reporte de Actividades
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="previewActividadesReport()">
                                            üëÅÔ∏è Vista Previa
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Vista Previa Actividades -->
                                <div id="actividadesPreview" class="report-preview" style="display: none;">
                                    <h4>Vista Previa - Reporte de Actividades</h4>
                                    <div class="preview-table-container">
                                        <table class="preview-table" id="actividadesPreviewTable">
                                            <thead>
                                                <tr>
                                                    <th>ID Consultor</th>
                                                    <th>Nombre Consultor</th>
                                                    <th>ID Cliente</th>
                                                    <th>Cliente (Empresa)</th>
                                                    <th>Proyecto</th>
                                                    <th>Tarea</th>
                                                    <th>M√≥dulo</th>
                                                    <th>Horas Totales</th>
                                                </tr>
                                            </thead>
                                            <tbody id="actividadesPreviewBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte de Pagos -->
                            <div id="pagos-config" class="report-config" style="display: none;">
                                <h3>üí∞ Configuraci√≥n - Reporte de Pago Consultores</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label for="pagosTimeFilter">Per√≠odo:</label>
                                        <select id="pagosTimeFilter">
                                            <option value="week">Esta Semana</option>
                                            <option value="month">Este Mes</option>
                                            <option value="custom">Rango Personalizado</option>
                                            <option value="all">Todas las Fechas</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group" id="pagosCustomDateRange" style="display: none;">
                                        <label for="pagosStartDate">Fecha Inicio:</label>
                                        <input type="date" id="pagosStartDate">
                                        
                                        <label for="pagosEndDate">Fecha Fin:</label>
                                        <input type="date" id="pagosEndDate">
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosConfiguration()">
                                            üîß Configurar Tarifas y Generar
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Configuraci√≥n de Tarifas -->
                                <div id="pagosConfiguration" class="pagos-configuration" style="display: none;">
                                    <h4>Configuraci√≥n de Tarifas por Consultor</h4>
                                    <div class="tariff-info">
                                        <p><strong>Instrucciones:</strong> Ajuste las horas y tarifas por consultor. El total se calcular√° autom√°ticamente.</p>
                                    </div>
                                    <div class="tariff-table-container">
                                        <table class="tariff-table" id="tariffConfigTable">
                                            <thead>
                                                <tr>
                                                    <th>ID Consultor</th>
                                                    <th>Nombre Consultor</th>
                                                    <th>Cliente</th>
                                                    <th>Proyecto</th>
                                                    <th>Horas Reportadas</th>
                                                    <th>Horas Ajustadas</th>
                                                    <th>Tarifa por Hora ($)</th>
                                                    <th>Total ($)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tariffConfigBody"></tbody>
                                        </table>
                                    </div>
                                    <div class="tariff-actions">
                                        <button type="button" class="btn btn-success" onclick="generatePagosReport()">
                                            üí∞ Generar Reporte Final de Pagos
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="resetTariffs()">
                                            üîÑ Restablecer Tarifas
                                        </button>
                                    </div>
                                    <div class="tariff-summary">
                                        <div class="summary-item">
                                            <strong>Total Horas: <span id="totalHours">0</span></strong>
                                        </div>
                                        <div class="summary-item">
                                            <strong>Total a Pagar: $<span id="totalAmount">0.00</span></strong>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuraci√≥n Pago Consultor General -->
                            <div id="pago-consultor-general-config" class="report-config" style="display: none;">
                                <h3>üè¢ Configuraci√≥n - Pago Consultor (General)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte consolida los pagos de todos los consultores en todas las empresas. Las horas y tarifas son editables antes de generar el Excel.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosGeneralConfiguration()">
                                            üìä Generar Vista Previa
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainer">
                                    <!-- Aqu√≠ se carga la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Pago Consultor Individual -->
                            <div id="pago-consultor-individual-config" class="report-config" style="display: none;">
                                <h3>üë§ Configuraci√≥n - Pago Consultor (Individual)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte muestra los pagos de un consultor espec√≠fico. Primero deber√° seleccionar el consultor y luego las horas y tarifas ser√°n editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadPagosIndividualConfiguration()">
                                            üë§ Seleccionar Consultor
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerIndividual">
                                    <!-- Aqu√≠ se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Cliente Soporte -->
                            <div id="cliente-soporte-config" class="report-config" style="display: none;">
                                <h3>üìû Configuraci√≥n - Cliente Soporte</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte muestra los servicios de soporte por m√≥dulo para un cliente espec√≠fico. Primero deber√° seleccionar el cliente y luego las horas y tarifas ser√°n editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadClienteSoporteConfiguration()">
                                            üë§ Seleccionar Cliente
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerSoporte">
                                    <!-- Aqu√≠ se carga el selector de cliente y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte Proyecto -->
                            <div id="reporte-proyecto-config" class="report-config" style="display: none;">
                                <h3>üìã Configuraci√≥n - Reporte Proyecto</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte muestra todos los consultores trabajando en un proyecto espec√≠fico. Primero deber√° seleccionar el proyecto y luego las horas y tarifas ser√°n editables.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadReporteProyectoConfiguration()">
                                            üìã Seleccionar Proyecto
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyecto">
                                    <!-- Aqu√≠ se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte Proyecto (Cliente) -->
                            <div id="reporte-proyecto-cliente-config" class="report-config" style="display: none;">
                                <h3>üè¢ Configuraci√≥n - Rep. Proyecto (Cliente)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte muestra los proyectos trabajados para un cliente espec√≠fico, agrupados por m√≥dulos. Ideal para presentaci√≥n externa al cliente.</p>
                                    </div>
                                    <div class="form-group" style="text-align: center;">
                                    <button type="button" class="btn btn-primary" onclick="loadReporteProyectoClienteConfiguration()">
                                        üè¢ Seleccionar Cliente
                                    </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyectoCliente">
                                    <!-- Aqu√≠ se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte Proyecto (Consultor) -->
                            <div id="reporte-proyecto-consultor-config" class="report-config" style="display: none;">
                                <h3>üë§ Configuraci√≥n - Rep. Proyecto (Consultor)</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este reporte muestra el trabajo individual de un consultor espec√≠fico en un proyecto particular. Ideal para evaluaciones de desempe√±o y reportes personales.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadReporteProyectoConsultorConfiguration()">
                                            üë§ Seleccionar Consultor
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerProyectoConsultor">
                                    <!-- Aqu√≠ se carga el selector y la tabla editable -->
                                </div>
                            </div>

                            <!-- Configuraci√≥n Reporte Remanente -->
                            <div id="reporte-remanente-config" class="report-config" style="display: none;">
                                <h3>üìä Configuraci√≥n - Reporte Remanente</h3>
                                <div class="config-form">
                                    <div class="form-group">
                                        <label>Informaci√≥n:</label>
                                        <p class="config-info">Este es el reporte m√°s complejo del sistema. Muestra una matriz semanal de horas remanentes por m√≥dulo en un per√≠odo mensual espec√≠fico. Las semanas se calculan autom√°ticamente seg√∫n los d√≠as del mes.</p>
                                    </div>
                                    
                                    <div class="form-group" style="text-align: center;">
                                        <button type="button" class="btn btn-primary" onclick="loadRemanenteConfiguration()">
                                            üìä Configurar Reporte Remanente
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Contenedor para la vista previa -->
                                <div id="reportPreviewContainerRemanente">
                                    <!-- Aqu√≠ se carga el selector y la matriz editable -->
                                </div>
                            </div>

                            <!-- Opciones Generales -->
                            <div class="report-options">
                                <h3>Opciones Generales</h3>
                                <div class="form-group">
                                    <button type="button" class="btn btn-secondary" onclick="exportData()">
                                        üíæ Exportar Datos Completos
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="importData()">
                                        üìÅ Importar Datos
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="generateAdminReport()">
                                        üìã Reporte Administrativo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n de Historial de Reportes Generados -->
                    <div id="historial-reportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">üìú Historial de Reportes Generados</h2>
                            <button class="add-btn" onclick="refreshGeneratedReportsList()">üîÑ Actualizar</button>
                        </div>
                        
                        <!-- Filtros para Historial -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="historialTimeFilter">Per√≠odo:</label>
                                <select id="historialTimeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todos los Reportes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="historialTypeFilter">Tipo:</label>
                                <select id="historialTypeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="all">Todos los Tipos</option>
                                    <option value="actividades">Reportes de Actividades</option>
                                    <option value="pagos">Reportes de Pagos</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="historialCustomDateRange" style="display: none;">
                                <label for="historialStartDate">Fecha Inicio:</label>
                                <input type="date" id="historialStartDate" onchange="updateGeneratedReportsList()">
                                
                                <label for="historialEndDate">Fecha Fin:</label>
                                <input type="date" id="historialEndDate" onchange="updateGeneratedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="historialFilterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        

                        <!-- Tabla de Reportes Generados -->
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="generatedReportsTable">
                                <thead>
                                    <tr>
                                        <th>Nombre del Archivo</th>
                                        <th>Tipo de Reporte</th>
                                        <th>Per√≠odo</th>
                                        <th>Registros</th>
                                        <th>Horas Totales</th>
                                        <th>Monto Total</th>
                                        <th>Fecha Generaci√≥n</th>
                                        <th>Descargas</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="generatedReportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìä</div>
                                                <div class="empty-state-title">No hay reportes generados</div>
                                                <div class="empty-state-desc">Los reportes Excel generados aparecer√°n en este historial</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Estad√≠sticas del Historial -->
                        <div class="historial-stats">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalGeneratedReports">0</div>
                                    <div class="stat-label">Total Reportes</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalActividadReports">0</div>
                                    <div class="stat-label">Rep. Actividades</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalPagoReports">0</div>
                                    <div class="stat-label">Rep. Pagos</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="totalDownloads">0</div>
                                    <div class="stat-label">Total Descargas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Usuario -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë§ Crear Nuevo Usuario</h2>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm" class="admin-form">
                    <div class="form-group">
                        <label for="userName">Nombre Completo *</label>
                        <input type="text" id="userName" placeholder="Ej: Juan P√©rez Garc√≠a" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email (opcional)</label>
                        <input type="email" id="userEmail" placeholder="juan.perez@empresa.com">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Usuario</button>
                    </div>
                </form>
                <div class="message message-info">
                    <strong>Informaci√≥n:</strong> El sistema generar√° autom√°ticamente un ID √∫nico y una contrase√±a temporal para el nuevo usuario.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üè¢ Registrar Nueva Empresa</h2>
                <button class="close" onclick="closeModal('companyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="companyForm" class="admin-form">
                    <div class="form-group">
                        <label for="companyName">Nombre de la Empresa *</label>
                        <input type="text" id="companyName" placeholder="Ej: Tecnolog√≠a Avanzada SA de CV" required>
                    </div>
                    <div class="form-group">
                        <label for="companyDescription">Descripci√≥n (opcional)</label>
                        <textarea id="companyDescription" placeholder="Breve descripci√≥n de la empresa y sus servicios" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Registrar Empresa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Proyecto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìã Crear Nuevo Proyecto</h2>
                <button class="close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm" class="admin-form">
                    <div class="form-group">
                        <label for="projectName">Nombre del Proyecto *</label>
                        <input type="text" id="projectName" placeholder="Ej: Sistema de Gesti√≥n Empresarial" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Descripci√≥n (opcional)</label>
                        <textarea id="projectDescription" placeholder="Descripci√≥n detallada del proyecto" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectStatus">Estado del Proyecto</label>
                        <select id="projectStatus">
                            <option value="Planificaci√≥n">Planificaci√≥n</option>
                            <option value="En Progreso" selected>En Progreso</option>
                            <option value="En Pausa">En Pausa</option>
                            <option value="Completado">Completado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Proyecto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Soporte -->
    <div id="supportModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">üìû Crear Nuevo Soporte</h2>
            <button class="close" onclick="closeModal('supportModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="supportForm" class="admin-form">
                <div class="form-group">
                    <label for="supportName">Nombre del Soporte *</label>
                    <input type="text" id="supportName" placeholder="Ej: Soporte t√©cnico sistema ERP" required>
                </div>
                <div class="form-group">
                    <label for="supportDescription">Descripci√≥n (opcional)</label>
                    <textarea id="supportDescription" placeholder="Descripci√≥n detallada del soporte" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="supportPriority">Prioridad</label>
                    <select id="supportPriority">
                        <option value="Baja">Baja</option>
                        <option value="Media" selected>Media</option>
                        <option value="Alta">Alta</option>
                        <option value="Cr√≠tica">Cr√≠tica</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportType">Tipo de Soporte</label>
                    <select id="supportType">
                        <option value="T√©cnico">T√©cnico</option>
                        <option value="Funcional">Funcional</option>
                        <option value="Configuraci√≥n">Configuraci√≥n</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Crear Soporte</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal M√≥dulo -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üß© Crear Nuevo M√≥dulo</h2>
                <button class="close" onclick="closeModal('moduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="moduleForm" class="admin-form">
                    <div class="form-group">
                        <label for="moduleName">Nombre del M√≥dulo *</label>
                        <input type="text" id="moduleName" placeholder="Ej: M√≥dulo MM" required>
                    </div>
                    <div class="form-group">
                        <label for="moduleDescription">Descripci√≥n (opcional)</label>
                        <textarea id="moduleDescription" placeholder="Descripci√≥n detallada del m√≥dulo" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear M√≥dulo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
<script src="../js/database.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/utils.js"></script>
<script src="js/pago-consultor-general.js"></script>
<script src="js/pago-consultor-individual.js"></script>
<script src="js/cliente-soporte.js"></script>
<script src="js/reporte-proyecto.js"></script>
<script src="js/reporte-proyecto-cliente.js"></script>
<script src="js/reporte-proyecto-consultor.js"></script>
<script src="js/reporte-remanente.js"></script>
<script src="admin.js"></script>
</body>
</html>