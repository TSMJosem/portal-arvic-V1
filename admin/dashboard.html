<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador - GRUPO IT ARVIC</title>
    <link rel="stylesheet" href="../css/shared.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/arvic-pdf-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
   
</head>
<body class="admin-layout">
    <header class="admin-header">
        <nav class="navbar">
            <div class="logo">
                <img src="../images/Logo Grupo IT Arvic 33.svg" alt="GRUPO IT ARVIC" class="admin-logo-svg">
            </div>
            <div class="user-info">
                <span id="adminUserName">Hector Perez</span>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
            </div>
        </nav>
    </header>

    <main class="admin-content">
        <div class="container">
            <!-- Layout con Sidebar -->
            <div class="admin-layout-wrapper">
                <!-- Sidebar de Navegación -->
                <div class="admin-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title"> <i class="fa-solid fa-chart-bar"></i> Gestión General</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item active" data-section="usuarios">
                                <span class="menu-icon"> <i class="fa-solid fa-users"></i> </span>
                                <span class="menu-text">Usuarios</span>
                                <span class="menu-badge" id="sidebarUsersCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="empresas">
                                <span class="menu-icon"> <i class="fa-solid fa-building"> </i> </span>
                                <span class="menu-text">Empresas</span>
                                <span class="menu-badge" id="sidebarCompaniesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="proyectos">
                                <span class="menu-icon"> <i class="fa-solid fa-folder-open"></i> </span>
                                <span class="menu-text">Proyectos</span>
                                <span class="menu-badge" id="sidebarProjectsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="soportes">
                                <span class="menu-icon"> <i class="fa-solid fa-headset"></i> </span>
                                <span class="menu-text">Soportes</span>
                                <span class="menu-badge" id="sidebarSupportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="modulos">
                                <span class="menu-icon"> <i class="fa-solid fa-puzzle-piece"></i> </span>
                                <span class="menu-text">Módulos</span>
                                <span class="menu-badge" id="sidebarModulesCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="tarifario">
                                <span class="menu-icon"> <i class="fa-solid fa-dollar-sign"></i> </span>
                                <span class="menu-text">Tarifario</span>
                                <span class="menu-badge" id="sidebarTarifarioCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title"> <i class="fa-solid fa-bullseye"></i> Asignaciones</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="crear-asignacion">
                                <span class="menu-icon"> <i class="fa-solid fa-plus"></i> </span>
                                <span class="menu-text">Asignar Soportes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="lista-asignaciones">
                                <span class="menu-icon"> <i class="fa-solid fa-folder-open"></i> </span>
                                <span class="menu-text">Lista Completa</span>
                                <span class="menu-badge" id="sidebarAssignmentsCount">0</span>
                            </div>
                            
                            <div class="sidebar-menu-item" data-section="asignaciones-recientes">
                                <span class="menu-icon"> <i class="fa-solid fa-clock"></i> </span>
                                <span class="menu-text">Recientes</span>
                            </div>

                            <div class="sidebar-menu-item" data-section="asignar-proyectos">
                                <span class="menu-icon"> <i class="fa-solid fa-plus"></i> </span>
                                <span class="menu-text">Asignar Proyectos</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="lista-proyectos-asignados">
                                <span class="menu-icon"> <i class="fa-solid fa-folder-open"></i> </span>
                                <span class="menu-text">Proyectos Asignados</span>
                                <span class="menu-badge" id="sidebarProjectAssignmentsCount">0</span>
                            </div>
                             <div class="sidebar-menu-item" data-section="taskAssignments">
                                <span class="menu-icon"> <i class="fa-solid fa-tasks"></i> </span>
                                <span class="menu-text">Tareas</span>
                                <span class="menu-badge" id="sidebarTaskCount">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3 class="sidebar-section-title"> <i class="fa-solid fa-file"></i> Reportes</h3>
                        <div class="sidebar-menu">
                            <div class="sidebar-menu-item" data-section="reportes-pendientes">
                                <span class="menu-icon"> <i class="fa-solid fa-chart-bar"></i> </span>
                                <span class="menu-text">Reportes Pendientes</span>
                                <span class="menu-badge" id="sidebarReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="reportes-aprobados">
                                <span class="menu-icon"> <i class="fa-solid fa-check"></i> </span>
                                <span class="menu-text">Reportes Aprobados</span>
                                <span class="menu-badge" id="sidebarApprovedReportsCount">0</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="generar-reporte">
                                <span class="menu-icon"> <i class="fa-solid fa-file-alt"></i> </span>
                                <span class="menu-text">Generar Reporte</span>
                            </div>
                            <div class="sidebar-menu-item" data-section="historial-reportes">
                                <span class="menu-icon"> <i class="fa-solid fa-scroll"></i> </span>
                                <span class="menu-text">Historial Generados</span>
                                <span class="menu-badge" id="sidebarGeneratedReportsCount">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contenido Principal -->
                <div class="admin-main-content">
                    <!-- Sección de Usuarios -->
                    <div id="usuarios-section" class="content-section active">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-users"></i> Gestión de Usuarios</h2>
                            <button class="add-btn" onclick="openUserModal()">+ Nuevo Usuario</button>
                        </div>
                        <div class="items-list" id="usersList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-user"></i> </div>
                                <div class="empty-state-title">No hay usuarios</div>
                                <div class="empty-state-desc">Cree el primer usuario consultor</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Empresas -->
                    <div id="empresas-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-building"></i> Gestión de Empresas</h2>
                            <button class="add-btn" onclick="openCompanyModal()">+ Nueva Empresa</button>
                        </div>
                        <div class="items-list" id="companiesList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-building"></i> </div>
                                <div class="empty-state-title">No hay empresas</div>
                                <div class="empty-state-desc">Registre la primera empresa cliente</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Proyectos -->
                    <div id="proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-folder-open"></i> Gestión de Proyectos</h2>
                            <button class="add-btn" onclick="openProjectModal()">+ Nuevo Proyecto</button>
                        </div>
                        <div class="items-list" id="projectsList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-folder-open"></i> </div>
                                <div class="empty-state-title">No hay proyectos</div>
                                <div class="empty-state-desc">Cree el primer proyecto</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Soportes -->
                    <div id="soportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-headset"></i> Gestión de Soportes</h2>
                            <button class="add-btn" onclick="openSupportModal()">+ Nuevo Soporte</button>
                        </div>
                        <div class="items-list" id="supportsList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-headset"></i> </div>
                                <div class="empty-state-title">No hay soportes</div>
                                <div class="empty-state-desc">Cree el primer soporte</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Módulos -->
                    <div id="modulos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-puzzle-piece"></i> Gestión de Módulos</h2>
                            <button class="add-btn" onclick="openModuleModal()">+ Nuevo Módulo</button>
                        </div>
                        <div class="items-list" id="modulesList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-puzzle-piece"></i> </div>
                                <div class="empty-state-title">No hay módulos</div>
                                <div class="empty-state-desc">Cree el primer módulo</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Nueva Asignación -->
                    <div id="crear-asignacion-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-plus"></i> Crear Nueva Asignación de Soporte</h2>
                        </div>
                        <div class="assignment-form-container">
                            <!-- ============================================================
                                FORMULARIO DE ASIGNACIÓN DE SOPORTE CON GRID 2 COLUMNAS
                                Reemplaza toda la estructura desde <div class="assignment-form">
                                hasta su cierre en la sección "crear-asignacion-section"
                                ============================================================ -->

                            <div class="assignment-form">
                                <!-- COLUMNA IZQUIERDA: Campos principales -->
                                <div class="main-fields-column">
                                    <div class="form-group">
                                        <label for="assignUser">Usuario Consultor</label>
                                        <select id="assignUser" name="assignUser" required>
                                            <option value="">Seleccionar usuario</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignCompany">Empresa Cliente</label>
                                        <select id="assignCompany" name="assignCompany" required>
                                            <option value="">Seleccionar empresa</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignSupport">Soporte</label>
                                        <select id="assignSupport" name="assignSupport" required>
                                            <option value="">Seleccionar Soporte</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignModule">Módulos</label>
                                        <select id="assignModule" name="assignModule" required>
                                            <option value="">Seleccionar Módulo</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- COLUMNA DERECHA: Configuración de Tarifas -->
                                <div class="tarifa-column">
                                    <div class="tarifa-section">
                                        <h3> <i class="fa-solid fa-dollar-sign"></i> Configuración de Tarifas</h3>
                                        
                                        <div class="tarifa-inputs">
                                            <div class="form-group">
                                                <label for="assignTarifaConsultor">Tarifa Consultor ($/hora)</label>
                                                <input 
                                                    type="number" 
                                                    id="assignTarifaConsultor" 
                                                    name="assignTarifaConsultor" 
                                                    step="0.01" 
                                                    min="0" 
                                                    placeholder="300.00"
                                                    required
                                                >
                                                <small class="form-hint">Costo por hora que se le paga al consultor</small>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="assignTarifaCliente">Tarifa Cliente ($/hora)</label>
                                                <input 
                                                    type="number" 
                                                    id="assignTarifaCliente" 
                                                    name="assignTarifaCliente" 
                                                    step="0.01" 
                                                    min="0" 
                                                    placeholder="500.00"
                                                    required
                                                >
                                                <small class="form-hint">Costo por hora que se le cobra al cliente</small>
                                            </div>
                                        </div>
                                        
                                        <div class="margen-display">
                                            <div class="margen-info">
                                                <span class="margen-label">Margen:</span>
                                                <span id="assignMargen" class="margen-value">$0.00</span>
                                                <span id="assignMargenPorcentaje" class="margen-percent">(0%)</span>
                                            </div>
                                            <div id="assignMargenWarning" class="margen-warning" style="display: none;">
                                                ⚠️ El margen es negativo
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- FILA COMPLETA: Botón de submit -->
                                <div class="form-submit-row">
                                    <button type="button" class="btn btn-primary" onclick="createAssignment()">
                                        <i class="fa-solid fa-plus"></i> Crear Asignación
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Asignar Proyectos -->
                    <div id="asignar-proyectos-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-plus"></i> Crear Nueva Asignación de Proyecto</h2>
                        </div>
                        
                        <div class="assignment-form-container">
                            <div class="assignment-form">
                                <!-- COLUMNA IZQUIERDA: Campos principales -->
                                <div class="main-fields-column">
                                    <div class="form-group">
                                        <label for="assignProjectConsultor">Consultor</label>
                                        <select id="assignProjectConsultor" name="assignProjectConsultor" required>
                                            <option value="">Seleccionar consultor</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignProjectProject">Proyecto</label>
                                        <select id="assignProjectProject" name="assignProjectProject" required>
                                            <option value="">Seleccionar proyecto</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignProjectCompany">Empresa Cliente</label>
                                        <select id="assignProjectCompany" name="assignProjectCompany" required>
                                            <option value="">Seleccionar empresa cliente</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="assignProjectModule">Módulo</label>
                                        <select id="assignProjectModule" name="assignProjectModule" required>
                                            <option value="">Seleccionar módulo</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- COLUMNA DERECHA: Configuración de Tarifas -->
                                <div class="tarifa-column">
                                    <div class="tarifa-section">
                                        <h3> <i class="fa-solid fa-dollar-sign"></i> Configuración de Tarifas</h3>
                                        
                                        <div class="tarifa-inputs">
                                            <div class="form-group">
                                                <label for="projectAssignTarifaConsultor">Tarifa Consultor ($/hora)</label>
                                                <input 
                                                    type="number" 
                                                    id="projectAssignTarifaConsultor" 
                                                    name="projectAssignTarifaConsultor" 
                                                    step="0.01" 
                                                    min="0" 
                                                    placeholder="300.00"
                                                    required
                                                >
                                                <small class="form-hint">Costo por hora que se le paga al consultor</small>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="projectAssignTarifaCliente">Tarifa Cliente ($/hora)</label>
                                                <input 
                                                    type="number" 
                                                    id="projectAssignTarifaCliente" 
                                                    name="projectAssignTarifaCliente" 
                                                    step="0.01" 
                                                    min="0" 
                                                    placeholder="500.00"
                                                    required
                                                >
                                                <small class="form-hint">Costo por hora que se le cobra al cliente</small>
                                            </div>
                                        </div>
                                        
                                        <div class="margen-display">
                                            <div class="margen-info">
                                                <span class="margen-label">Margen:</span>
                                                <span id="projectAssignMargen" class="margen-value">$0.00</span>
                                                <span id="projectAssignMargenPorcentaje" class="margen-percent">(0%)</span>
                                            </div>
                                            <div id="projectAssignMargenWarning" class="margen-warning" style="display: none;">
                                                ⚠️ El margen es negativo
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- FILA COMPLETA: Botón de submit -->
                                <div class="form-submit-row">
                                    <button type="button" class="btn btn-primary" onclick="createProjectAssignment()">
                                        <i class="fa-solid fa-plus"></i> Asignar Proyecto
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Lista de Proyectos Asignados -->
                    <div id="lista-proyectos-asignados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-folder-open"></i> Proyectos Asignados</h2>
                        </div>
                        
                        <div id="projectAssignmentsList" class="project-assignments-container">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-bullseye"></i> </div>
                                <div class="empty-state-title">No hay proyectos asignados</div>
                                <div class="empty-state-desc">Los proyectos asignados a consultores aparecerán aquí</div>
                            </div>
                        </div>
                    </div>

                    <!-- SECCIÓN: ASIGNACIONES DE TAREAS -->
                    <div id="taskAssignments-section" class="content-section">
                        <div class="section-header">
                            <div class="section-title">
                                <h2><i class="fa-solid fa-tasks"></i> Asignaciones de Tareas</h2>
                                <p class="section-description">Gestionar tareas específicas vinculadas a soportes</p>
                            </div>
                            <button class="btn btn-primary" onclick="openCreateTaskModal()">
                                <i class="fa-solid fa-plus"></i> Nueva Tarea
                            </button>
                        </div>

                        <!-- Filtros -->
                        <div class="filters-container">
                            <div class="filter-group">
                                <label><i class="fa-solid fa-building"></i> Cliente:</label>
                                <select id="taskFilterCompany" class="filter-select" onchange="filterTasks()">
                                    <option value="">Todos los clientes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label><i class="fa-solid fa-headset"></i> Soporte:</label>
                                <select id="taskFilterSupport" class="filter-select" onchange="filterTasks()">
                                    <option value="">Todos los soportes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label><i class="fa-solid fa-user"></i> Consultor:</label>
                                <select id="taskFilterConsultor" class="filter-select" onchange="filterTasks()">
                                    <option value="">Todos los consultores</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label><i class="fa-solid fa-toggle-on"></i> Estado:</label>
                                <select id="taskFilterStatus" class="filter-select" onchange="filterTasks()">
                                    <option value="active">Activas</option>
                                    <option value="inactive">Inactivas</option>
                                    <option value="all">Todas</option>
                                </select>
                            </div>
                        </div>

                        <!-- Tabla de Tareas -->
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Consultor</th>
                                        <th>Cliente</th>
                                        <th>Soporte Padre</th>
                                        <th>Módulo</th>
                                        <th>Descripción</th>
                                        <th>Tarifa Consultor</th>
                                        <th>Tarifa Cliente</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="taskAssignmentsTableBody">
                                    <tr>
                                        <td colspan="10" class="empty-state">
                                            <i class="fa-solid fa-tasks fa-3x"></i>
                                            <p>No hay tareas asignadas</p>
                                            <button class="btn btn-primary" onclick="openCreateTaskModal()">
                                                Crear Primera Tarea
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Sección de Lista de Asignaciones -->
                    <div id="lista-asignaciones-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-clipboard-list"></i> Lista Completa de Asignaciones</h2>
                        </div>
                        <div class="assignments-list" id="assignmentsList">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-link"></i> </div>
                                <div class="empty-state-title">No hay asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones creadas aparecerán en esta lista</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección de Asignaciones Recientes -->
                    <div id="asignaciones-recientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-clock"></i> Asignaciones Recientes</h2>
                        </div>
                        <div class="items-list" id="recentAssignments">
                            <div class="empty-state">
                                <div class="empty-state-icon"> <i class="fa-solid fa-bullseye"></i> </div>
                                <div class="empty-state-title">Sin asignaciones</div>
                                <div class="empty-state-desc">Las asignaciones recientes aparecerán aquí</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Pendientes -->
                    <div id="reportes-pendientes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-chart-line"></i> Reportes Pendientes</h2>
                        </div>
                        
                        <!-- ✨ NUEVO: Filtros por Categoría -->
                        <div class="reports-category-filters">
                            <div class="filter-buttons-group">
                                <button class="category-filter-btn active" data-category="all" onclick="filterReportsByCategory('all')">
                                    <span class="filter-icon"> <i class="fa-solid fa-chart-pie"></i> </span>
                                    <span class="filter-text">Todos</span>
                                    <span class="filter-count" id="filterCountAll">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="soporte" onclick="filterReportsByCategory('soporte')">
                                    <span class="filter-icon"> <i class="fa-solid fa-headset"></i> </span>
                                    <span class="filter-text">Soporte</span>
                                    <span class="filter-count" id="filterCountSoporte">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="proyecto" onclick="filterReportsByCategory('proyecto')">
                                    <span class="filter-icon"> <i class="fa-solid fa-folder-open"></i> </span>
                                    <span class="filter-text">Proyecto</span>
                                    <span class="filter-count" id="filterCountProyecto">0</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="reportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte/Proyecto</th>
                                        <th>Módulo</th>
                                        <th>Descripción</th>
                                        <th>Horas Reportadas</th>
                                        <th>Fecha Reporte</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon"> <i class="fa-solid fa-file"></i> </div>
                                                <div class="empty-state-title">No hay reportes</div>
                                                <div class="empty-state-desc">Los reportes enviados por consultores aparecerán aquí</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tabla de Reportes Aprobados -->
                    <div id="reportes-aprobados-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-check"></i> Reportes Aprobados - Horas Acumuladas</h2>
                        </div>
                        
                        <div class="reports-category-filters">
                            <div class="filter-buttons-group">
                                <button class="category-filter-btn active" data-category="all" onclick="filterApprovedReportsByCategory('all')">
                                    <span class="filter-icon"> <i class="fa-solid fa-chart-pie"></i> </span>
                                    <span class="filter-text">Todos</span>
                                    <span class="filter-count" id="approvedFilterCountAll">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="soporte" onclick="filterApprovedReportsByCategory('soporte')">
                                    <span class="filter-icon"> <i class="fa-solid fa-headset"></i> </span>
                                    <span class="filter-text">Soporte</span>
                                    <span class="filter-count" id="approvedFilterCountSoporte">0</span>
                                </button>
                                <button class="category-filter-btn" data-category="proyecto" onclick="filterApprovedReportsByCategory('proyecto')">
                                    <span class="filter-icon"> <i class="fa-solid fa-folder-open"></i> </span>
                                    <span class="filter-text">Proyecto</span>
                                    <span class="filter-count" id="approvedFilterCountProyecto">0</span>
                                </button>
                            </div>
                        </div>

                        <!-- Filtros de Fecha -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="timeFilter">Filtrar por:</label>
                                <select id="timeFilter" onchange="updateApprovedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todas las Fechas</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="customDateRange" style="display: none;">
                                <label for="startDate">Fecha Inicio:</label>
                                <input type="date" id="startDate" onchange="updateApprovedReportsList()">
                                
                                <label for="endDate">Fecha Fin:</label>
                                <input type="date" id="endDate" onchange="updateApprovedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="filterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="approvedReportsTable">
                                <thead>
                                    <tr>
                                        <th>ID Consultor</th>
                                        <th>Nombre Consultor</th>
                                        <th>ID Cliente</th>
                                        <th>Cliente (Empresa)</th>
                                        <th>Soporte</th>
                                        <th>Módulo</th>
                                        <th>Horas Acumuladas</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedReportsTableBody">
                                    <tr>
                                        <td colspan="7" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon"> <i class="fa-solid fa-check"></i> </div>
                                                <div class="empty-state-title">No hay reportes aprobados</div>
                                                <div class="empty-state-desc">Los reportes aprobados aparecerán aquí con horas acumuladas</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                            <!-- Sección de Generar Reporte -->
                            <div id="generar-reporte-section" class="content-section">
                                <div class="section-header">
                                    <h2 class="section-title"> <i class="fa-solid fa-clipboard"></i> Sistema de Reportes ARVIC</h2>
                                    <p class="section-subtitle">Genere reportes detallados según documentación oficial</p>
                                </div>
                                
                                <!-- Selector de Reportes -->
                                <div class="report-selector">
                                    <h3> <i class="fa-solid fa-bullseye"></i> Seleccionar Tipo de Reporte</h3>
                                    <div class="report-grid" id="reportGrid">
                                        <!-- Se generará dinámicamente con JavaScript -->
                                    </div>
                                </div>

                                <!-- Panel de Configuración Dinámico -->
                                <div class="report-config-panel" id="reportConfigPanel" style="display: none;">
                                    <!-- Se generará dinámicamente según el reporte seleccionado -->
                                </div>

                                <!-- Vista Previa Editable -->
                                <div class="preview-panel" id="reportPreviewPanel" style="display: none;">
                                    <!-- Se generará dinámicamente según los datos -->
                                </div>
                            </div>

                    <!-- Sección de Historial de Reportes Generados -->
                    <div id="historial-reportes-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-scroll"></i> Historial de Reportes Generados</h2>
                            <button class="add-btn" onclick="refreshGeneratedReportsList()"><i class="fa-solid fa-sync"></i> Actualizar</button>
                        </div>
                        
                        <!-- Filtros para Historial -->
                        <div class="reports-filters">
                            <div class="filter-group">
                                <label for="historialTimeFilter">Período:</label>
                                <select id="historialTimeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="week">Esta Semana</option>
                                    <option value="month">Este Mes</option>
                                    <option value="custom">Rango Personalizado</option>
                                    <option value="all">Todos los Reportes</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="historialTypeFilter">Tipo:</label>
                                <select id="historialTypeFilter" onchange="updateGeneratedReportsList()">
                                    <option value="all">Todos los Tipos</option>
                                    <option value="pago-consultor-general"> <i class="fa-solid fa-money-bill"></i> Pago Consultor (General)</option>
                                    <option value="pago-consultor-especifico"> <i class="fa-solid fa-user"></i> Pago Consultor (Específico)</option>
                                    <option value="cliente-soporte"> <i class="fa-solid fa-headset"></i> Cliente Soporte</option>
                                    <option value="remanente"> <i class="fa-solid fa-chart-pie"></i> Remanente</option>
                                    <option value="proyecto-general"> <i class="fa-solid fa-folder-open"></i> Proyecto (General)</option>
                                    <option value="proyecto-cliente"> <i class="fa-solid fa-building"></i> Proyecto (Cliente)</option>
                                    <option value="proyecto-consultor"> <i class="fa-solid fa-user"></i> Proyecto (Consultor)</option>
                                </select>
                            </div>
                            
                            <div class="filter-group" id="historialCustomDateRange" style="display: none;">
                                <label for="historialStartDate">Fecha Inicio:</label>
                                <input type="date" id="historialStartDate" onchange="updateGeneratedReportsList()">
                                
                                <label for="historialEndDate">Fecha Fin:</label>
                                <input type="date" id="historialEndDate" onchange="updateGeneratedReportsList()">
                            </div>
                            
                            <div class="filter-info">
                                <span id="historialFilterInfo">Mostrando: Esta semana</span>
                            </div>
                        </div>
                        
                    
                        <!-- Tabla de Reportes Generados -->
                        <div class="reports-table-container">
                            <table class="admin-table reports-table" id="generatedReportsTable">
                                <thead>
                                    <tr>
                                        <th>Nombre del Archivo</th>
                                        <th>Tipo de Reporte</th>
                                        <th>Período</th>
                                        <th>Registros</th>
                                        <th>Horas Totales</th>
                                        <th>Monto Total</th>
                                        <th>Fecha Generación</th>
                                        <th>Descargas</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="generatedReportsTableBody">
                                    <tr>
                                        <td colspan="9" class="empty-table-message">
                                            <div class="empty-state">
                                                <div class="empty-state-icon"> <i class="fa-solid fa-chart-pie"></i> </div>
                                                <div class="empty-state-title">No hay reportes generados</div>
                                                <div class="empty-state-desc">Los reportes Excel generados aparecerán en este historial</div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Estadísticas del Historial -->
                        <div class="historial-stats">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalGeneratedReports">0</div>
                                    <div class="stat-label">Total Reportes</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportPagoGeneral">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-money-bill"></i> Pago (General)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportPagoEspecifico">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-user"></i> Pago (Específico)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportClienteSoporte">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-headset"></i> Cliente Soporte</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportRemanente">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-chart-pie"></i> Remanente</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportProyectoGeneral">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-folder-open"></i> Proyecto (General)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportProyectoCliente">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-building"></i> Proyecto (Cliente)</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-number" id="reportProyectoConsultor">0</div>
                                    <div class="stat-label"> <i class="fa-solid fa-user"></i> Proyecto (Consultor)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                            <!-- Sección de Tarifario -->
                    <div id="tarifario-section" class="content-section">
                        <div class="section-header">
                            <h2 class="section-title"> <i class="fa-solid fa-dollar-sign"></i> Tarifario - Gestión de Costos</h2>
                            <button class="btn btn-export" onclick="exportTarifarioToExcel()">
                                <i class="fa-solid fa-file-excel"></i> Exportar a Excel
                            </button>
                        </div>

                        <!-- Filtros de tipo -->
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all" onclick="filterTarifarioByType('all')">
                                <i class="fa-solid fa-list"></i> Todos
                            </button>
                            <button class="filter-btn" data-filter="support" onclick="filterTarifarioByType('support')">
                                <i class="fa-solid fa-headset"></i> Soportes
                            </button>
                            <button class="filter-btn" data-filter="project" onclick="filterTarifarioByType('project')">
                                <i class="fa-solid fa-folder-open"></i> Proyectos
                            </button>
                            <button class="filter-btn" data-filter="task" onclick="filterTarifarioByType('task')">
                                <i class="fa-solid fa-tasks"></i> Tareas
                            </button>
                        </div>
                        <!-- Estadísticas rápidas -->
                        <div class="tarifario-stats">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fa-solid fa-chart-pie"></i></div>
                                <div class="stat-content">
                                    <span class="stat-label">Total Asignaciones</span>
                                    <span class="stat-value" id="totalAsignaciones">0</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fa-solid fa-money-bill"></i></div>
                                <div class="stat-content">
                                    <span class="stat-label">Margen Promedio</span>
                                    <span class="stat-value" id="margenPromedio">$0.00</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fa-solid fa-chart-line"></i></div>
                                <div class="stat-content">
                                    <span class="stat-label">Total Consultores</span>
                                    <span class="stat-value" id="totalConsultores">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de Unión -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title"><i class="fa-solid fa-chart-pie"></i> Tabla de Unión - Asignaciones con Tarifas</h3>
                                <div class="table-info">
                                    <span id="tarifarioCount">0 asignaciones</span>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="tarifario-table">
                                    <thead>
                                        <tr>
                                            <th>Tipo</th>
                                            <th>ID Asignación</th>
                                            <th>Módulo</th>
                                            <th>Consultor</th>
                                            <th>Cliente</th>
                                            <th>Trabajo</th>
                                            <th>Costo Consultor</th>
                                            <th>Costo Cliente</th>
                                            <th>Margen</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tarifarioTableBody">
                                        <tr>
                                            <td colspan="10" class="empty-state-cell">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon"><i class="fa-solid fa-money-bill"></i></div>
                                                    <div class="empty-state-title">No hay tarifas configuradas</div>
                                                    <div class="empty-state-desc">Las tarifas se crean automáticamente al crear asignaciones</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tabla de Consultores -->
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title"><i class="fa-solid fa-user"></i> Resumen por Consultor</h3>
                                <div class="table-info">
                                    <span id="consultoresCount">0 consultores</span>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="consultores-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Total Asignaciones</th>
                                            <th>Módulos</th>
                                            <th>Clientes</th>
                                            <th>Promedio Tarifa</th>
                                        </tr>
                                    </thead>
                                    <tbody id="consultoresTableBody">
                                        <tr>
                                            <td colspan="6" class="empty-state-cell">
                                                <div class="empty-state">
                                                    <div class="empty-state-icon"><i class="fa-solid fa-user"></i></div>
                                                    <div class="empty-state-title">No hay consultores con asignaciones</div>
                                                    <div class="empty-state-desc">Asigne proyectos o soportes a consultores para ver el resumen</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Usuario -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fa-solid fa-user"></i> Crear Nuevo Usuario</h2>
                <button class="close" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm" class="admin-form">
                    <div class="form-group">
                        <label for="userName">Nombre Completo *</label>
                        <input type="text" id="userName" placeholder="Ej: Juan Pérez García" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email (opcional)</label>
                        <input type="email" id="userEmail" placeholder="juan.perez@empresa.com">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Usuario</button>
                    </div>
                </form>
                <div class="message message-info">
                    <strong>Información:</strong> El sistema generará automáticamente un ID único y una contraseña temporal para el nuevo usuario.
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Empresa -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fa-solid fa-building"></i> Registrar Nueva Empresa</h2>
                <button class="close" onclick="closeModal('companyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="companyForm" class="admin-form">
                    <div class="form-group">
                        <label for="companyName">Nombre de la Empresa *</label>
                        <input type="text" id="companyName" placeholder="Ej: Tecnología Avanzada SA de CV" required>
                    </div>
                    <div class="form-group">
                        <label for="companyDescription">Descripción (opcional)</label>
                        <textarea id="companyDescription" placeholder="Breve descripción de la empresa y sus servicios" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Registrar Empresa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Proyecto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fa-solid fa-folder-open"></i> Crear Nuevo Proyecto</h2>
                <button class="close" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm" class="admin-form">
                    <div class="form-group">
                        <label for="projectName">Nombre del Proyecto *</label>
                        <input type="text" id="projectName" placeholder="Ej: Sistema de Gestión Empresarial" required>
                    </div>
                    <div class="form-group">
                        <label for="projectDescription">Descripción (opcional)</label>
                        <textarea id="projectDescription" placeholder="Descripción detallada del proyecto" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Proyecto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Soporte -->
    <div id="supportModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title"><i class="fa-solid fa-headset"></i> Crear Nuevo Soporte</h2>
            <button class="close" onclick="closeModal('supportModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="supportForm" class="admin-form">
                <div class="form-group">
                    <label for="supportName">Nombre del Soporte *</label>
                    <input type="text" id="supportName" placeholder="Ej: Soporte técnico sistema ERP" required>
                </div>
                <div class="form-group">
                    <label for="supportDescription">Descripción (opcional)</label>
                    <textarea id="supportDescription" placeholder="Descripción detallada del soporte" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Crear Soporte</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal: Crear/Editar Tarea -->
    <div id="taskModal" class="modal" style="display: none;">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="taskModalTitle"><i class="fa-solid fa-tasks"></i> Nueva Tarea</h3>
                <button class="modal-close" onclick="closeTaskModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="taskForm" onsubmit="saveTask(event)">
                    <input type="hidden" id="taskId" value="">
                    
                    <!-- Paso 1: Información Básica -->
                    <div class="form-section">
                        <h4><i class="fa-solid fa-info-circle"></i> Información Básica</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskCompany">
                                    <i class="fa-solid fa-building"></i> Cliente *
                                </label>
                                <select id="taskCompany" class="form-control" required onchange="loadSupportsByCompany(this.value)">
                                    <option value="">Seleccionar cliente...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="taskSupport">
                                    <i class="fa-solid fa-headset"></i> Soporte Padre *
                                </label>
                                <select id="taskSupport" class="form-control" required disabled>
                                    <option value="">Primero selecciona un cliente...</option>
                                </select>
                                <small class="form-help">La tarea se vinculará a este soporte</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskConsultor">
                                    <i class="fa-solid fa-user"></i> Consultor *
                                </label>
                                <select id="taskConsultor" class="form-control" required>
                                    <option value="">Seleccionar consultor...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="taskModule">
                                    <i class="fa-solid fa-puzzle-piece"></i> Módulo *
                                </label>
                                <select id="taskModule" class="form-control" required>
                                    <option value="">Seleccionar módulo...</option>
                                </select>
                                <small class="form-help">Puede ser diferente al del soporte</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Paso 2: Descripción de la Tarea -->
                    <div class="form-section">
                        <h4><i class="fa-solid fa-file-alt"></i> Descripción de la Tarea</h4>
                        
                        <div class="form-group">
                            <label for="taskDescription">
                                <i class="fa-solid fa-align-left"></i> Descripción *
                            </label>
                            <textarea 
                                id="taskDescription" 
                                class="form-control" 
                                rows="4" 
                                required
                                placeholder="Ej: Migración de Oracle 12c a Oracle 19c con validación de integridad de datos"
                                maxlength="500"
                            ></textarea>
                            <small class="form-help">
                                <span id="taskDescriptionCount">0</span>/500 caracteres
                            </small>
                        </div>
                    </div>
                    
                    <!-- Paso 3: Tarifas -->
                    <div class="form-section">
                        <h4><i class="fa-solid fa-money-bill"></i> Tarifas</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskTarifaConsultor">
                                    <i class="fa-solid fa-user-tie"></i> Tarifa Consultor ($/hr) *
                                </label>
                                <input 
                                    type="number" 
                                    id="taskTarifaConsultor" 
                                    class="form-control" 
                                    required
                                    min="0"
                                    step="0.01"
                                    placeholder="600.00"
                                    oninput="calculateTaskMargen()"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="taskTarifaCliente">
                                    <i class="fa-solid fa-building"></i> Tarifa Cliente ($/hr) *
                                </label>
                                <input 
                                    type="number" 
                                    id="taskTarifaCliente" 
                                    class="form-control" 
                                    required
                                    min="0"
                                    step="0.01"
                                    placeholder="850.00"
                                    oninput="calculateTaskMargen()"
                                >
                            </div>
                        </div>
                        
                        <div class="margen-display">
                            <i class="fa-solid fa-chart-line"></i>
                            <span>Margen:</span>
                            <strong id="taskMargen">$0.00</strong>
                            <span id="taskMargenPorcentaje">(0%)</span>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeTaskModal()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-save"></i> Guardar Tarea
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Módulo -->
    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fa-solid fa-puzzle-piece"></i> Crear Nuevo Módulo</h2>
                <button class="close" onclick="closeModal('moduleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="moduleForm" class="admin-form">
                    <div class="form-group">
                        <label for="moduleName">Nombre del Módulo *</label>
                        <input type="text" id="moduleName" placeholder="Ej: Módulo MM" required>
                    </div>
                    <div class="form-group">
                        <label for="moduleDescription">Descripción (opcional)</label>
                        <textarea id="moduleDescription" placeholder="Descripción detallada del módulo" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Crear Módulo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/databaseMongoDB.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/utils.js"></script>
    <script src="admin.js"></script>
    <script src="../js/module-acronym-utils.js"></script>
    <script src="../js/arvic-pdf-exporter.js"></script>
</body>
</html>